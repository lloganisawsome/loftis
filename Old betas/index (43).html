<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Loftis Button - Larger Reverse Rain</title>
  <style>
    /* Base Styles */
    * {
      box-sizing: border-box;
      user-select: none;
    }
    body {
      background-color: #1b1b1b;
      color: white;
      font-family: "Comic Sans MS", sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      min-height: 100vh;
      overflow-x: hidden;
      margin: 0;
      gap: 25px;
      padding-bottom: 100px;
      padding-top: 10px;
    }

    /* --- Top Counters Bar --- */
    #countersBar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      display: flex;
      flex-wrap: wrap;
      justify-content: flex-start;
      background: #000;
      padding: 5px 10px;
      z-index: 100;
      gap: 10px;
      border-bottom: 2px solid #ff4747;
      max-height: 80px;
      overflow-y: auto;
    }
    .counter-item-top {
      display: flex;
      align-items: center;
      padding: 5px 10px;
      background: #333;
      border-radius: 5px;
      font-size: 0.9rem;
      flex-shrink: 0;
    }
    .counter-item-top .counter-name {
      margin-right: 10px;
      color: #ff4747;
    }
    .counter-item-top .counter-controls {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .counter-item-top button {
      background: #555;
      color: white;
      border: none;
      padding: 3px 6px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 0.8rem;
    }
    .counter-item-top button.increment { background: #4CAF50; }
    .counter-item-top button.decrement { background: #ffa500; }
    .counter-item-top button.remove { background: #ff4747; }
    .counter-item-top .counter-value {
      font-weight: bold;
      margin: 0 5px;
    }

    /* Chill Add Counter Button Style */
    #addCounterBtnTop {
      background: #222;
      color: #ff4747;
      border: 1px solid #ff4747;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }
    #addCounterBtnTop:hover {
      background: #ff4747;
      color: #000;
    }

    /* Main Content Padding to compensate for fixed top bar */
    .title {
        margin-top: 80px;
    }

    /* Title/Header */
    .title {
      display: flex;
      align-items: center;
      gap: 25px;
      font-size: 3rem;
      color: #ff4747;
      text-shadow: 0 0 15px rgba(255, 0, 0, 0.7);
      animation: glow 2s ease-in-out infinite alternate;
      text-align: center;
    }
    .title img {
      width: 150px;
      height: auto;
      border-radius: 0;
      box-shadow: none;
      animation: floaty 3s ease-in-out infinite alternate;
    }
    @keyframes glow {
      from { text-shadow: 0 0 10px #ff4747; }
      to { text-shadow: 0 0 30px #ff4747; }
    }
    @keyframes floaty {
      from { transform: translateY(0px); }
      to { transform: translateY(-10px); }
    }
    /* Emoji Board */
    .emoji-board {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: 20px;
      width: 90%;
      max-width: 600px;
    }
    .emoji-board button {
      font-size: 3rem;
      background: #333;
      border: none;
      border-radius: 15px;
      padding: 15px;
      cursor: pointer;
      transition: 0.2s;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
    }
    .emoji-board button:hover {
      background: #555;
      transform: scale(1.1);
    }
    .hiller-emoji img {
      width: 60px;
      height: auto;
      border-radius: 10px;
      pointer-events: none;
    }
    /* Input Area */
    #inputArea {
      display: flex;
      gap: 10px;
      align-items: center;
      width: 90%;
      max-width: 600px;
    }
    input {
      background: #222;
      border: 2px solid #555;
      color: white;
      padding: 10px 15px;
      border-radius: 10px;
      flex-grow: 1;
      font-size: 1rem;
      outline: none;
    }
    #sayBtn {
      background: #4CAF50;
      color: white;
      padding: 10px 20px;
      border-radius: 10px;
      border: none;
      font-size: 1rem;
      cursor: pointer;
    }
    #sayBtn:hover {
      background: #45a049;
    }
    #loftisBtn {
      background: red;
      color: white;
      font-size: 1.5rem;
      padding: 20px 40px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(255,0,0,0.5);
      border: none;
      cursor: pointer;
    }

    /* --- Reverse Rain Floating Image Effect --- */
    /* This animation is applied to temporary images */
    .float-img {
      position: absolute;
      width: 600px; /* NEW: Larger size for floating images */
      height: 600px; /* NEW: Larger size for floating images */
      object-fit: contain; /* Ensure image fits within bounds */
      pointer-events: none;
      animation: floatReverse 2.5s ease-out forwards; /* Increased duration slightly */
      z-index: 1000;
    }
    @keyframes floatReverse {
        0% { transform: scale(0.1) rotate(0deg); opacity: 1; } /* Start smaller scale, full opacity */
        100% { transform: scale(1) rotate(-720deg); opacity: 0; top: -100px; } /* End at original scale, fade out */
    }

    /* --- Lizard Animation (Right to Left) --- */
    @keyframes slide-lizard {
      from {
        transform: translateX(0);
      }
      to {
        transform: translateX(-120vw);
      }
    }
    .lizard-mover {
        position: fixed;
        top: 50%;
        right: 0;
        font-size: 5rem;
        z-index: 1500;
        animation: slide-lizard 5s linear forwards;
        pointer-events: none;
    }


    /* --- Toggled Note/List Area Styles --- */
    #toggleListBtn {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #007bff;
      color: white;
      padding: 15px 30px;
      border-radius: 30px;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 123, 255, 0.5);
      z-index: 50;
      transition: background 0.3s;
    }
    #toggleListBtn:hover {
      background: #0056b3;
    }

    #toggledContainer {
      position: fixed;
      bottom: -100%;
      left: 0;
      width: 100%;
      max-height: 80vh;
      background: #282828;
      box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.5);
      z-index: 40;
      transition: bottom 0.5s ease-out;
      padding: 20px;
      overflow-y: auto;
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
    }
    #toggledContainer.visible {
      bottom: 0;
    }

    /* Note/List Input Area */
    #noteArea {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    #noteInput {
      background: #333;
      border: 2px solid #555;
      color: white;
      padding: 15px;
      border-radius: 10px;
      width: 100%;
      min-height: 150px;
      font-size: 1rem;
      outline: none;
      resize: vertical;
    }
    #saveStatus {
        font-size: 0.8rem;
        color: #999;
        text-align: right;
    }
  </style>

</head>
<body>

  <div id="countersBar">
    <button class="add-new" id="addCounterBtnTop">âž• Add Counter</button>
  </div>

  <div class="title">
    <img src="loftis.png" alt="Loftis">
    <span>Loftis Button</span>
    <img src="loftis.png" alt="Loftis">
  </div>

  <div class="emoji-board">
    <button data-text="lizard" data-effect="lizard">ðŸ¦Ž</button>
    <button data-text="stop">â›”</button>
    <button data-text="skull">ðŸ’€</button>
    <button data-text="cool">ðŸ˜Ž</button>
    <button data-text="mic drop 1 2 1 2 loftis!">ðŸŽ¤</button>
    <button data-text="HEY!...... smiles" class="hiller-emoji" data-effect="hiller">
      <img src="hiller.png" alt="Hiller">
    </button>
    <button data-text="F around the room">F</button>
  </div>

  <div id="inputArea">
    <input type="text" id="sayInput" placeholder="Type something...">
    <button id="sayBtn">Say it</button>
  </div>

  <button id="loftisBtn" data-effect="loftis">LOFTIS</button>

  <button id="toggleListBtn">Toggle Note</button>

  <div id="toggledContainer">
    <h2>My Note/List</h2>
    <div id="noteArea">
      <textarea id="noteInput" placeholder="Type your note or list items here. They will auto-save."></textarea>
      <div id="saveStatus">Status: Ready</div>
    </div>
  </div>

  <script type="module">
    // --- Modular Firebase SDK Imports ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getDatabase, ref, push, set, onChildAdded, onChildChanged, onChildRemoved, update, remove, onValue } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

    // --- 1. Firebase Configuration ---
    const firebaseConfig = {
      apiKey: "AIzaSyBSY_eWimqv-E7MoJiEskIAIDSdlqmmBTE",
      authDomain: "generaluse-f4fea.firebaseapp.com",
      databaseURL: "https://generaluse-f4fea-default-rtdb.firebaseio.com",
      projectId: "generaluse-f4fea",
      storageBucket: "generaluse-f4fea.firebasestorage.app",
      messagingSenderId: "515153345419",
      appId: "1:515153345419:web:82fbb20992b4780b4d4d8e",
      measurementId: "G-V38M6NM36D"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const countersRef = ref(database, 'counters');
    const noteRef = ref(database, 'note/mainNote');


    // --- 2. DOM Elements and Utility Functions ---
    const emojis = document.querySelectorAll('.emoji-board button');
    const loftisBtn = document.getElementById('loftisBtn');
    const sayBtn = document.getElementById('sayBtn');
    const sayInput = document.getElementById('sayInput');
    const toggleListBtn = document.getElementById('toggleListBtn');
    const toggledContainer = document.getElementById('toggledContainer');
    const noteInput = document.getElementById('noteInput');
    const saveStatus = document.getElementById('saveStatus');
    const countersBar = document.getElementById('countersBar');
    const addCounterBtnTop = document.getElementById('addCounterBtnTop');
    
    let counters = {}; // Local state for counters

    function debounce(func, timeout = 1000) {
      let timer;
      return (...args) => {
        clearTimeout(timer);
        timer = setTimeout(() => { func.apply(this, args); }, timeout);
      };
    }

    function speak(text) {
      const msg = new SpeechSynthesisUtterance(text);
      msg.lang = 'en-US';
      msg.pitch = 1;
      msg.rate = 1;
      window.speechSynthesis.speak(msg);
    }

    // UPDATED: Reverse Rain (Floating Images) Function
    function startReverseRain(src, count = 40) {
      for (let i = 0; i < count; i++) {
        const img = document.createElement('img');
        img.src = src;
        img.className = 'float-img'; // Uses the floatReverse keyframes

        // Start from a random position at the bottom of the screen
        img.style.left = `${Math.random() * window.innerWidth - (600 / 2)}px`; // Center X, accounting for image size
        img.style.top = `${window.innerHeight + Math.random() * 200}px`; // Start further off-screen bottom

        // Add a random delay for a scattered look
        img.style.animationDelay = `${Math.random() * 0.7}s`; // Slightly longer random delay

        document.body.appendChild(img);
        setTimeout(() => img.remove(), 3000); // Adjusted removal time to match new animation duration
      }
    }
    
    // Handle Lizard Animation
    function startLizardAnimation() {
        const lizardMover = document.createElement('div');
        lizardMover.textContent = 'ðŸ¦Ž';
        lizardMover.classList.add('lizard-mover');
        document.body.appendChild(lizardMover);

        setTimeout(() => {
            lizardMover.remove();
        }, 5500);
    }

    // --- 3. Speech and Image Button Handlers (Simplified for Reverse Rain) ---
    emojis.forEach(btn => {
      btn.addEventListener('click', () => {
        const text = btn.dataset.text;
        const effect = btn.dataset.effect;
        speak(text);

        if (effect === 'lizard') {
            startLizardAnimation();
        } else if (effect === 'hiller') {
            startReverseRain('hiller.png', 40);
        } else if (text.toLowerCase().includes('loftis')) {
          // This catches the 'mic drop' button which contains 'loftis'
          startReverseRain('loftis.png', 40);
        }
      });
    });

    sayBtn.addEventListener('click', () => {
      const text = sayInput.value.trim();
      if (text !== "") speak(text);
      sayInput.value = '';
    });

    // Updated: Main LOFTIS button handler
    loftisBtn.addEventListener('click', () => {
      speak("Loftis");
      startReverseRain('loftis.png', 60); // Use a higher count for the main button
    });


    // --- 4. Counter Management Functions (Unchanged) ---
    function createCounterElement(id, name, value) {
      const existing = countersBar.querySelector(`[data-id="${id}"]`);
      if (existing) existing.remove();

      const div = document.createElement('div');
      div.className = 'counter-item-top';
      div.dataset.id = id;

      div.innerHTML = `
        <span class="counter-name">${name}:</span>
        <div class="counter-controls">
          <button class="decrement" data-action="decrement">-</button>
          <span class="counter-value">${value}</span>
          <button class="increment" data-action="increment">+</button>
          <button class="remove" data-action="remove">X</button>
        </div>
      `;
      countersBar.insertBefore(div, addCounterBtnTop);
    }

    function updateCounterValue(id, delta) {
      if (counters[id]) {
        counters[id].value += delta;
        const counterPath = ref(database, `counters/${id}`);
        update(counterPath, {
          value: counters[id].value
        });
        const div = countersBar.querySelector(`[data-id="${id}"]`);
        if (div) {
          div.querySelector('.counter-value').textContent = counters[id].value;
        }
      }
    }

    function removeCounter(id) {
        const counterPath = ref(database, `counters/${id}`);
        remove(counterPath);
    }

    addCounterBtnTop.addEventListener('click', () => {
      const name = prompt("Enter a name for the new counter:");
      if (name && name.trim() !== "") {
        const newCounter = {
          name: name.trim(),
          value: 0
        };
        push(countersRef, newCounter);
      }
    });

    countersBar.addEventListener('click', (event) => {
      const button = event.target.closest('button');
      if (!button || button === addCounterBtnTop) return;

      const div = event.target.closest('.counter-item-top');
      if (!div) return;

      const id = div.dataset.id;
      const action = button.dataset.action;

      if (action === 'increment') {
        updateCounterValue(id, 1);
      } else if (action === 'decrement') {
        updateCounterValue(id, -1);
      } else if (action === 'remove') {
        if (confirm(`Delete counter "${counters[id].name}"?`)) {
            removeCounter(id);
        }
      }
    });

    // --- 5. Firebase Realtime Listeners for Counters (Unchanged) ---
    onChildAdded(countersRef, (snapshot) => {
      const id = snapshot.key;
      const data = snapshot.val();
      counters[id] = data;
      createCounterElement(id, data.name, data.value);
    });

    onChildChanged(countersRef, (snapshot) => {
      const id = snapshot.key;
      const data = snapshot.val();
      counters[id] = data;
      const div = countersBar.querySelector(`[data-id="${id}"]`);
      if (div) {
        div.querySelector('.counter-value').textContent = data.value;
        div.querySelector('.counter-name').textContent = data.name + ':';
      } else {
        createCounterElement(id, data.name, data.value);
      }
    });

    onChildRemoved(countersRef, (snapshot) => {
      const id = snapshot.key;
      delete counters[id];
      const div = countersBar.querySelector(`[data-id="${id}"]`);
      if (div) div.remove();
    });

    // --- 6. Toggled Note/List Functionality (Unchanged) ---
    const saveNoteToFirebase = () => {
        const noteContent = noteInput.value;
        saveStatus.textContent = 'Status: Saving...';
        set(noteRef, noteContent)
            .then(() => {
                saveStatus.textContent = 'Status: Saved';
                setTimeout(() => { saveStatus.textContent = 'Status: Ready'; }, 1500);
            })
            .catch(() => {
                saveStatus.textContent = 'Status: Save Failed';
            });
    };

    const debouncedSaveNote = debounce(saveNoteToFirebase, 1500);

    noteInput.addEventListener('input', () => {
        saveStatus.textContent = 'Status: Typing...';
        debouncedSaveNote();
    });

    toggleListBtn.addEventListener('click', () => {
      toggledContainer.classList.toggle('visible');
      if (toggledContainer.classList.contains('visible')) {
        toggleListBtn.textContent = 'Hide Note';
        noteInput.focus();
      } else {
        toggleListBtn.textContent = 'Toggle Note';
        saveNoteToFirebase();
      }
    });

    onValue(noteRef, (snapshot) => {
        const note = snapshot.val();
        if (note !== null) {
            noteInput.value = note;
        }
        saveStatus.textContent = 'Status: Loaded';
        setTimeout(() => { saveStatus.textContent = 'Status: Ready'; }, 1500);
    });

  </script>
</body>
</html>